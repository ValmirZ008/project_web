# Бот для тренировки знаний для физматов
## Папка src
Файлы и классы:

**Основной файл бота test.py**

Назначение: Основной файл бота, содержащий логику обработки команд, генерации задач и взаимодействия с пользователем.

## Основные функции:

### Обработчики команд:
- `start_handler`: Обрабатывает команду `/start`, выводит приветственное сообщение и клавиатуру.
- `choose_difficulty_handler`: Обрабатывает выбор уровня сложности.
- `easy_difficulty_handler`, `medium_difficulty_handler`, `hard_difficulty_handler`: Обрабатывают выбор уровня сложности (лёгкий, средний, сложный).
- `back_to_main_menu`: Возвращает пользователя в главное меню.
- `math_tasks_handler`, `physics_tasks_handler`, `informatics_tasks_handler`: Обрабатывают выбор предмета для тренировки.
- `profile_handler`: Отображает профиль пользователя.
- `textbooks_handler`: Отображает список учебников.
- `statistics_handler`: Отображает статистику пользователя.
- `settings_handler`: Отображает настройки (в разработке).
- `training_handler`: Обрабатывает запрос на тренировку, выводит клавиатуру с выбором предмета.
- `check_answer`: Проверяет ответ пользователя на задачу.

### Вспомогательные функции:
- `random_math`, `random_physics`, `random_informatics`: Выбирают случайную задачу из соответствующего предмета.
- `main`: Запускает бота.

## Параметры и методы:

- `API_TOKEN`: Токен бота (необходимо заполнить перед запуском).
- `dp`: Диспетчер для обработки сообщений и команд.
- `bot`: Экземпляр бота с настройками по умолчанию.

**Файл: database.py**

Назначение: 
- Инициализации базы данных
- Добавления новых пользователей
- Хранения и обновления статистики по решённым задачам
- Получения статистики пользователя

### Основные функции

#### `init_db()`
Инициализирует базу данных. Создаёт таблицы `users` и `stats`, если они ещё не существуют.

---

#### `add_user(user_id: int, username: str)`
Добавляет нового пользователя в таблицу `users`, если он ещё не зарегистрирован.

- **Параметры:**
  - `user_id` — Telegram ID пользователя
  - `username` — имя пользователя

---

#### `update_stats(user_id: int, subject: str, is_correct: bool)`
Обновляет статистику по предмету для пользователя.

- Если запись уже существует:
  - Увеличивает счётчик `correct` или `incorrect`
- Если записи нет:
  - Создаёт новую с начальными значениями

- **Параметры:**
  - `user_id` — Telegram ID пользователя
  - `subject` — предмет (строка)
  - `is_correct` — результат ответа (`True` — правильный, `False` — неправильный)

#### `get_stats(user_id: int)`
Возвращает обобщённую статистику по всем предметам для пользователя.

- **Параметры:**
  - `user_id` — Telegram ID пользователя

- **Возвращает:** кортеж `(correct, incorrect, total)`  
  Если статистики нет, возвращает `(0, 0, 0)`


**Файл: ai_generator.py**

Назначение

Скрипт взаимодействует с моделью искусственного интеллекта через API OpenRouter для генерации учебных задач (математика, физика, информатика) с ожидаемым форматом вывода:  
`<целочисленный_ответ> <текст_условия>`.

Используется потоковая генерация (`stream=True`) от модели `google/gemini-2.0-flash-exp:free`.

---

### Основные компоненты

#### Переменные

- `API_KEY` — ключ доступа к OpenRouter API (требуется для авторизации).
- `MODEL` — название модели, используемой для генерации (`google/gemini-2.0-flash-exp:free`).

---

### Функции

#### `process_content(content: str) -> str`
Очищает полученный текст от тегов `<think>` и `</think>`.

---

#### `chat_stream(prompt: str) -> str`
Отправляет запрос на OpenRouter API и получает потоковый ответ от модели.

- **Параметры:**
  - `prompt` — строка с запросом на генерацию задачи.
- **Процесс:**
  - Отправляется `POST`-запрос с JSON-параметрами к `/chat/completions`.
  - Ответ читается построчно.
  - Каждая строка обрабатывается и извлекается фрагмент текста (`content`) из поля `delta`.
  - Результат собирается в итоговую строку.
- **Возвращает:** итоговый сгенерированный текст (строка).

---

#### `deepseek_tester_main(p: str) -> tuple[str, str]`
Генерирует задачу по выбранному предмету (`math`, `inf`, `physics`) и возвращает кортеж из ответа и условия.

- **Параметры:**
  - `p` — сокращённое название предмета (`math`, `inf`, любое другое значение — `physics`).
- **Формат вывода:**  
  Кортеж `(answer, question)` — где:
  - `answer` — целочисленный ответ,
  - `question` — текст условия задачи.
- **Пример результата:**  
  `("42", "Найди значение выражения 6 * 7.")`

- **Особенности:**
  - Проверяет корректность формата (наличие пробела между ответом и условием).
  - В случае ошибки выбрасывает `ValueError`.


Каждая функция генерации задачи создает варианты ответов, формирует клавиатуру с кнопками и отправляет сообщение с задачей пользователю. Ответы проверяются функцией `check_answer`, которая уведомляет пользователя о правильности ответа.

Для запуска бота используется асинхронная функция `main`, которая запускает polling для получения обновлений от Telegram.
